<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Font Path Method</title>

  <style>
    html, body { margin:0; padding:0; background:#0b0b0e; overflow:hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #hud{
      position:fixed; left:18px; top:18px; width:280px; z-index:10;
      color:#eaeaf2; font-size:14px; line-height:1.2;
      background:rgba(20,20,26,.55);
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      padding:14px 14px 12px;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 16px 60px rgba(0,0,0,.35);
    }
    #hud h3{ margin:0 0 10px; font-size:15px; font-weight:700; opacity:.95; }
    #hud label{ display:block; margin:10px 0 6px; opacity:.9; }
    #hud input, #hud select{
      width:100%; box-sizing:border-box;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:#fff; border-radius:10px;
      padding:10px 10px;
      outline:none;
    }
    #hud input:focus, #hud select:focus{ border-color: rgba(157,124,255,.55); }
    .row{ display:flex; gap:10px; margin-top:10px; }
    .btn{
      flex:1; cursor:pointer;
      border-radius:999px;
      padding:10px 12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.08);
      color:#fff; font-weight:600;
      transition: transform .12s ease, background .12s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background:rgba(255,255,255,.12); }
    .btn.primary{ background: rgba(157,124,255,.22); border-color: rgba(157,124,255,.45); }
    .btn.primary:hover{ background: rgba(157,124,255,.28); }
    #msg{ margin-top:10px; font-size:12px; opacity:.85; white-space:pre-line; }
    #canvasWrap{ position:fixed; inset:0; }
  </style>
</head>

<body>
  <div id="canvasWrap"></div>

  <div id="hud">
    <h3>Font Path Method</h3>

    <label>Text（输入字母/字符串）</label>
    <input id="textInput" value="A" maxlength="20"/>

    <label>Function</label>
    <select id="fnSelect">
      <option value="sin">Sin</option>
      <option value="square">Square</option>
      <option value="tri">Triangle</option>
      <option value="saw">Sawtooth</option>
    </select>

    <label>Seed（可复现）</label>
    <input id="seedInput" value="12345" />

    <div class="row">
      <button class="btn" id="applyBtn">Apply</button>
      <button class="btn" id="randBtn">Randomize</button>
    </div>

    <div class="row">
      <button class="btn" id="saveBtn">Save PNG</button>
      <button class="btn primary" id="animBtn">Animate</button>
    </div>

    <div class="row">
      <button class="btn" id="resetBtn">Reset</button>
    </div>

    <div id="msg">Loading…</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>

  <script>
    const FONT_PATH = "assets/fonts/ABCFavoritHebrewBoldVariable-Trial.ttf";

    const CANVAS_W = 1440;
    const CANVAS_H = 900;

    let fontReady = false;
    let fontObj = null;

    let t = 0;
    let isAnimating = true;
    let animationSpeed = 0.02;

    let scaleVal = 1.6;
    let strokeW = 2.2;
    let amplitude = 12;
    let frequency = 1.2;
    let phase = 0;

    let currentFunction = "sin";
    let seed = 12345;
    let inputText = "A";

    const msgEl = () => document.getElementById("msg");

    function setMsg(s){ msgEl().textContent = s; }

    function applyFn(x){
      const TWO_PI = Math.PI * 2;
      const PI = Math.PI;
      switch(currentFunction){
        case "sin":    return Math.sin(x);
        case "square": return ((x % TWO_PI) < PI) ? 1 : -1;
        case "tri":    return (Math.asin(Math.sin(x)) * 2 / PI);
        case "saw":    return ((x % TWO_PI) / PI) - 1;
        default:       return Math.sin(x);
      }
    }

    function hashSeed(n){
      n = (n|0) ^ 0x9e3779b9;
      n = Math.imul(n ^ (n >>> 16), 0x85ebca6b);
      n = Math.imul(n ^ (n >>> 13), 0xc2b2ae35);
      return (n ^ (n >>> 16)) >>> 0;
    }

    function reseed(){
      const s = parseInt(document.getElementById("seedInput").value, 10);
      seed = Number.isFinite(s) ? s : 12345;
      randomSeed(hashSeed(seed));
      noiseSeed(hashSeed(seed));
    }

    function bindUI(){
      document.getElementById("applyBtn").onclick = () => {
        inputText = document.getElementById("textInput").value || "A";
        currentFunction = document.getElementById("fnSelect").value;
        reseed();
      };

      document.getElementById("randBtn").onclick = () => {
        const newSeed = Math.floor(Math.random()*999999);
        document.getElementById("seedInput").value = String(newSeed);
        reseed();
        amplitude = random(4, 28);
        frequency = random(0.6, 2.6);
        phase = random(0, Math.PI*2);
        strokeW = random(1.2, 4.0);
      };

      document.getElementById("saveBtn").onclick = () => {
        saveCanvas("font-path-method", "png");
      };

      document.getElementById("animBtn").onclick = () => {
        isAnimating = !isAnimating;
        document.getElementById("animBtn").textContent = isAnimating ? "Animate" : "Paused";
      };

      document.getElementById("resetBtn").onclick = () => {
        inputText = "A";
        document.getElementById("textInput").value = "A";
        currentFunction = "sin";
        document.getElementById("fnSelect").value = "sin";
        document.getElementById("seedInput").value = "12345";
        amplitude = 12;
        frequency = 1.2;
        phase = 0;
        strokeW = 2.2;
        scaleVal = 1.6;
        animationSpeed = 0.02;
        reseed();
      };
    }

    function setup(){
      const c = createCanvas(CANVAS_W, CANVAS_H);
      c.parent("canvasWrap");
      pixelDensity(window.devicePixelRatio || 1);
      smooth();

      bindUI();
      reseed();

      setMsg("Loading font...\n" + FONT_PATH);

      loadFont(
        FONT_PATH,
        (f) => {
          fontObj = f;
          fontReady = true;
          setMsg("Font loaded ✅\n" + FONT_PATH);
        },
        (err) => {
          console.error(err);
          fontReady = false;
          setMsg(
            "Font load failed ❌\n" +
            "请检查：\n" +
            "1) 字体是否真的在该路径\n" +
            "2) 文件名大小写是否一致\n\n" +
            "当前路径：\n" + FONT_PATH
          );
        }
      );
    }

    function drawGrid(){
      const cw = 280;
      const cell = 25;
      stroke(255,255,255,18);
      strokeWeight(1);
      for(let x=cw; x<=width; x+=cell) line(x, 0, x, height);
      for(let y=0; y<=height; y+=cell) line(cw, y, width, y);
    }

    function draw(){
      background(10,10,14);
      drawGrid();

      if(!fontReady || !fontObj){
        noStroke();
        fill(255,255,255,120);
        textSize(18);
        textAlign(CENTER, CENTER);
        text("Loading font...", width*0.6, height*0.5);
        return;
      }

      if(isAnimating) t += animationSpeed;

      const size = 240;
      const options = { sampleFactor: 0.12, simplifyThreshold: 0 };

      const pts = fontObj.textToPoints(inputText, 0, 0, size, options);
      const bounds = fontObj.textBounds(inputText, 0, 0, size);

      push();
      translate(width*0.60, height*0.52);
      scale(scaleVal);
      translate(-bounds.x - bounds.w/2, -bounds.y - bounds.h/2);

      noFill();
      stroke(255);
      strokeWeight(strokeW);
      beginShape(POINTS);

      for(let i=0;i<pts.length;i++){
        const p = pts[i];
        const n = noise(i*0.02, seed*0.001);
        const ang = n * Math.PI * 2;

        const dis = i * 0.03;
        const wave = applyFn(frequency * dis + phase + t);

        const off = wave * amplitude * (0.35 + n);
        const dx = Math.cos(ang) * off;
        const dy = Math.sin(ang) * off;

        vertex(p.x + dx, p.y + dy);
      }

      endShape();
      pop();
    }

    function windowResized(){
    }
  </script>
</body>
</html>
